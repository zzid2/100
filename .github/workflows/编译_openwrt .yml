#
# https://github.com/P3TERX/Actions-OpenWrt
#
# File: .github/workflows/openwrt-bulder.yml
# Description: Build OpenWrt using GitHub Actions
#
# Copyright (c) 2019-2024 P3TERX <https://p3terx.com>
#
# This is free software, licensed under the MIT License.
# See /LICENSE for more information.
#

name: ç¼–è¯‘OpenWRTå›ºä»¶              ## Actionså·¥ä½œæµçš„åç§°
on:
  repository_dispatch:             ## å‚¨å­˜åº“_è°ƒåº¦
  workflow_dispatch:               ## å·¥ä½œæµç¨‹_è°ƒåº¦
    inputs:
      ssh:                         ## åšåˆ¤æ–­æ—¶ç”¨çš„IDåç§°ï¼ˆå¯æ›´æ”¹ï¼‰  
        description: 'SSHè¿œç¨‹'     ## å·¥ä½œæµ_èœå•æç¤ºæ¡†çš„åç§°
        required: false
        default: 'true-false'       ## è¾“å…¥ï¼štrue=å¼€å¯ false=å…³é—­
      wxtz:
        description: 'å¾®ä¿¡é€šçŸ¥'
        required: false
        default: 'wxtz'            ## è¾“å…¥ï¼šwxtz=å¼€å¯ false=å…³é—­
      release:
        description: 'å‘å¸ƒå›ºä»¶'
        required: false
        default: 'release'         ## è¾“å…¥ï¼šrelease=å¼€å¯ actions=å…³é—­
        


#  schedule:                        ## å®šæ—¶è§¦å‘å¼€å§‹ç¼–è¯‘(æ—¶é—´è®¾ç½®è¯·çœ‹å®šæ—¶ç¼–è¯‘è¯´æ˜)
#    - cron: 0 8 */5 * *


#  watch:                           ## ç‚¹â˜†Starè§¦å‘å¼€å§‹ç¼–è¯‘
#    types: started


#  push:                            ## ä¿®æ”¹ä»»æ„ä»£ç ï¼ˆæˆ–æŒ‡å®šæ–‡ä»¶ï¼‰ è§¦å‘ç¼–è¯‘
#    branches:                      ## å½“åˆ†æ”¯ä»£ç å‡ºç°â€œä¿®æ”¹å˜åŠ¨æ—¶â€ è§¦å‘ç¼–è¯‘
#      - master                     ## é»˜è®¤æ˜¯ä¸»åˆ†æ”¯ä»£ç å˜åŠ¨æ—¶ï¼Œè§¦å‘ç¼–è¯‘

#    paths:                         ## å½“æŒ‡å®šæ–‡ä»¶â€œä¿®æ”¹å˜åŠ¨æ—¶â€ è§¦å‘ç¼–è¯‘
#      - 'diy.config'               ## é»˜è®¤æ˜¯diy.configæ–‡ä»¶å˜åŠ¨æ—¶ è§¦å‘ç¼–è¯‘


#  release:                         ## releaseå‘å¸ƒè§¦å‘å¼€å§‹ç¼–è¯‘(åªæ˜¯ä¸€ä¸ªè§¦å‘æ¡ä»¶,ä¸ä¼šå‘å¸ƒçš„,åˆéº»çƒ¦,æ²¡åµç”¨,ä¸ç”¨ç ”ç©¶)
#    types: published



#-----------------------------------------------------------------------------------------------------------------
# # å•æœºå‹_å„é¡¹é…ç½®å¼€å…³
  # FIRMWARE_NAME: OpenWRT_x86                                       ## å¾®ä¿¡æ¨é€å˜é‡åï¼ˆå›ºä»¶åç§°ä¸èƒ½å«ä¸­æ–‡ï¼‰
  # GITHUB_RELEASE: https://github.com/zuoweiid/10/releases          ## GitHubå‘å¸ƒåœ°å€ï¼Œä¿®æ”¹æˆè‡ªå·±çš„
  # REPO_URL: https://github.com/coolsnowwolf/lede                   ## OpenWRTæºç åœ°å€
  # REPO_BRANCH: master             ## â†æºç åˆ†æ”¯
  # FEEDS_CONF: feeds.conf.default  ## è‡ªå®šä¹‰feedsæ–‡ä»¶
  # CONFIG_FILE: .config            ## è‡ªå®šä¹‰configé…ç½®       å¤šæœºå‹é…ç½®æ–‡ä»¶å¦‚ï¼š(config/N1.config)
  # DIY_P1_SH: diy-part1.sh         ## è‡ªå®šä¹‰è„šæœ¬             å¤šæœºå‹è„šæœ¬æ–‡ä»¶å¦‚ï¼š(scripts/diy-part1.sh)
  # DIY_P2_SH: diy-part2.sh         ## è‡ªå®šä¹‰è„šæœ¬             å¤šæœºå‹è„šæœ¬æ–‡ä»¶å¦‚ï¼š(scripts/diy-part2.sh)
  #  ORGANIZE_FIRMWARE: false       ## æ•´ç†å›ºä»¶æ¸…é™¤packages
  # UPLOAD_CONFIG: true             ## â†ä¸Šä¼ configé…ç½®æ–‡ä»¶
  # UPLOAD_FIRMWARE: true           ## â†ä¸Šä¼ å›ºä»¶åˆ°gitthubç©ºé—´ï¼ˆé»˜è®¤å¿…é€‰trueï¼‰
  # UPLOAD_BIN_DIR: true            ## â†ä¸Šä¼ binæ–‡ä»¶å¤¹åˆ°_githubç©ºé—´ï¼ˆå›ºä»¶+ipkï¼‰
  # UPLOAD_RELEASE: true            ## â†å‘å¸ƒå›ºä»¶åˆ°_/releasesä¸»é¡µ
  # UPLOAD_COWTRANSFER: true        ## â†ä¸Šä¼ åˆ°_å¥¶ç‰›å¿«ä¼ 
  # UPLOAD_WETRANSFER: true         ## â†ä¸Šä¼ åˆ°_WeTransfer
  # EXTRACT_LINKS: true             ## æå–å¥¶ç‰›å¿«ä¼ å’ŒWeTransferé“¾æ¥
  # TZ: Asia/Shanghai               ## â†æ—¶åŒºè®¾ç½®
  # REPO_TOKEN: ${{ secrets.REPO_TOKEN }}   ## GitHubä»¤ç‰Œåç§°ï¼ˆç”¨äºå‘å¸ƒå›ºä»¶ï¼‰
  # SCKEY: ${{ secrets.SCKEY }}             ## ServerChanå¾®ä¿¡æ¨é€
#-----------------------------------------------------------------------------------------------------------------



env:
  TZ: Asia/Shanghai                      ## æ—¶åŒºè®¾ç½®
  REPO_TOKEN: ${{ secrets.REPO_TOKEN }}  ## REPO_TOKEN === GitHubä»¤ç‰Œå¯†é’¥ï¼ˆç”¨äºå‘å¸ƒå›ºä»¶ï¼‰
  SCKEY: ${{ secrets.SCKEY }}            ## SCKEY      === æ¨é€IDå¯†é’¥    ï¼ˆç”¨äºå¾®ä¿¡æ¨é€ï¼‰
  TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}      ## TELEGRAM_CHAT_ID   === TGç”µæŠ¥ç¾¤ä»¤ç‰Œ
  TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}  ## TELEGRAM_BOT_TOKEN === TGç”µæŠ¥ç¾¤å¯†é’¥
  Author: ${{github.actor}}                              ## æå– Githubç”¨æˆ·IDï¼Œå¦‚ï¼šzuoweiid
  GITURL: https://github.com/${{github.repository}}      ## æå– é¡¹ç›®ä»“åº“åœ°å€ = https://github.com +ï¼ˆç”¨æˆ·ID + é¡¹ç›®ä»“åº“åå­—ï¼‰ï¼Œå¦‚ï¼šzuoweiid/10
  Run_number: ${{github.run_number}}                     ## æå– Actionså½“å‰è¿è¡Œç¼–å·ï¼Œå¦‚#12



jobs:
  build:                                  ## è¿è¡Œè„šæœ¬çš„å¤‡æ³¨åç§°ï¼ˆå¯æ›´æ”¹ï¼‰
    runs-on: Ubuntu-20.04                 ## â†é€‰æ‹©ç¼–è¯‘ç³»ç»Ÿç‰ˆæœ¬
    if: github.event.repository.owner.id == github.event.sender.id   ## åªæœ‰ä»“åº“æ‰€æœ‰è€…æ‰èƒ½ä½¿ç”¨  â€œç‚¹ Starå¯åŠ¨ç¼–è¯‘â€
    
    
    name: ç¼–è¯‘ ${{matrix.target}}         ## å¤šæœºå‹åŒæ—¶ç¼–è¯‘ï¼›â€œç¼–è¯‘â€ åé¢æ˜¯é€‰æ‹©ç¼–è¯‘çš„æœºå‹åç§°ï¼›å¦‚ï¼šâ€œlede_x86â€
    strategy:
      fail-fast: false
      matrix:
        target: [lede_x86]                ## â†ç¼–è¯‘æŒ‡å®šæœºå‹ â€œå°±æ˜¯æ–‡ä»¶å¤¹åç§°â€ï¼Œå¤šé€‰ç”¨è‹±æ–‡é€—å·éš”å¼€å¯ä»¥åŒæ—¶ç¼–è¯‘ï¼›
        # ç›®å‰å¯ä»¥é€‰æœºå‹ï¼šopenwrt,  lede_G-DOCK,  lede_hiwifi_HC5861,  lede_linksys_Wrt32x,  lede_N1,  lede_x86

    
    steps:
    
    - name: å‡†å¤‡ç¯å¢ƒ                      ## Checkout
      uses: actions/checkout@v4           ## åŠ è½½æ‰§è¡Œä»“åº“ï¼šhttps://github.com/actions/checkout
      # uses: actions/setup-node@v4         ## åŠ è½½æ‰§è¡Œä»“åº“ï¼Œç”¨äºæŒ‡å®šNode.jsç‰ˆæœ¬
      # with:
        # node-version: 20.x                ## æŒ‡å®šNode.jsç‰ˆæœ¬ä¸ºï¼š20.x
    
    
    
#-----------------------------------------------------------------------------------------------------------------
# å•æœºå‹_é…ç½®è„šæœ¬ â€œsettings.iniâ€
#REPO_URL="https://github.com/project-openwrt/openwrt"     #ç¼–è¯‘å›ºä»¶æºç é“¾æ¥ï¼ˆè¯·å‹¿ä¿®æ”¹ï¼‰
#REPO_BRANCH="openwrt-18.06"         #æºç é“¾æ¥çš„åˆ†æ”¯ï¼ˆè¯·å‹¿ä¿®æ”¹ï¼‰
#CONFIG_FILE=".config"               #é…ç½®æ–‡ä»¶ï¼ˆå¯SSHè¿œç¨‹å®šåˆ¶å›ºä»¶æ’ä»¶ï¼Œä¹Ÿå¯åœ¨æœ¬åœ°æå–é…ç½®ç²˜è´´åˆ°æ­¤æ–‡ä»¶ï¼‰
#WXFB_MESSAGE="project_x86_64"       #å¾®ä¿¡é€šçŸ¥è·Ÿå‘å¸ƒè¦ç”¨åˆ°çš„åå­—,æ¯”å¦‚é€šçŸ¥ä½ XXå¼€å§‹ç¼–è¯‘,å‘å¸ƒçš„æ—¶å€™æ˜¾ç¤ºXXå›ºä»¶
#DIY_P1_SH="diy-1.sh"                #è‡ªå®šä¹‰æ–‡ä»¶1
#DIY_P2_SH="diy-2.sh"                #è‡ªå®šä¹‰æ–‡ä»¶2
#SSH_ACTIONS="false"                 #SSHè¿œç¨‹é…ç½®å›ºä»¶ï¼ˆtrue=å¼€å¯ï¼‰ï¼ˆfalse=å…³é—­ï¼‰
#UPLOAD_BIN_DIR="false"              #ä¸Šä¼ ã€binæ–‡ä»¶å¤¹ã€‘åˆ°githubç©ºé—´ï¼ˆtrue=å¼€å¯ï¼‰ï¼ˆfalse=å…³é—­ï¼‰
#UPLOAD_CONFIG="true"                #ä¸Šä¼ ã€.configã€‘é…ç½®æ–‡ä»¶åˆ°githubç©ºé—´ï¼ˆtrue=å¼€å¯ï¼‰ï¼ˆfalse=å…³é—­ï¼‰
#UPLOAD_FIRMWARE="true"              #ä¸Šä¼ å›ºä»¶åˆ°githubç©ºé—´ï¼ˆtrue=å¼€å¯ï¼‰ï¼ˆfalse=å…³é—­ï¼‰
#UPLOAD_COWTRANSFER="true"           #ä¸Šä¼ å›ºä»¶åˆ°ã€å¥¶ç‰›å¿«ä¼ ã€‘ï¼ˆtrue=å¼€å¯ï¼‰ï¼ˆfalse=å…³é—­ï¼‰
#UPLOAD_WETRANSFER="true"            #ä¸Šä¼ å›ºä»¶åˆ°ã€WETRANSFERã€‘ï¼ˆtrue=å¼€å¯ï¼‰ï¼ˆfalse=å…³é—­ï¼‰
#UPLOAD_RELEASE="false"              #å‘å¸ƒå›ºä»¶ï¼ˆtrue=å¼€å¯ï¼‰ï¼ˆfalse=å…³é—­ï¼‰
#SERVERCHAN_SCKEY="false"            #å¾®ä¿¡é€šçŸ¥ï¼ˆtrue=å¼€å¯ï¼‰ï¼ˆfalse=å…³é—­ï¼‰
#-----------------------------------------------------------------------------------------------------------------



    - name: åŠ è½½settings.iniè„šæœ¬å˜é‡      ## ç¼–è¯‘å‰åŠ è½½ /build/æœºå‹æ–‡ä»¶å¤¹/settings.ini è„šæœ¬
      run: |
        pwd && ls                                                                        # æ˜¾ç¤ºå½“å‰æ­¥éª¤çš„è·¯å¾„å’Œæ‰€æœ‰æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ï¼›
        
        source "${GITHUB_WORKSPACE}/build/${{matrix.target}}/settings.ini"               # åŠ è½½é…ç½®æ–‡ä»¶ï¼š/é¡¹ç›®ä»“åº“åç§°/build/æœºå‹æ–‡ä»¶/settings.iniï¼ˆæ¯ä¸ªæœºå‹æ–‡ä»¶å¤¹å†…éƒ½æœ‰è¿™ä¸ªé…ç½®æ–‡ä»¶ï¼‰
        echo "REPO_URL=${REPO_URL}" >> $GITHUB_ENV                                       # = å›ºä»¶æºç åœ°å€
        echo "REPO_BRANCH=${REPO_BRANCH}" >> $GITHUB_ENV                                 # = å›ºä»¶æºç çš„åˆ†æ”¯
        echo "CONFIG_FILE=${CONFIG_FILE}" >> $GITHUB_ENV                                 # = .configé…ç½®æ–‡ä»¶
        echo "DIY_P1_SH=${DIY_P1_SH}" >> $GITHUB_ENV                                     # = DIY_P1_SHçš„å˜é‡
        echo "DIY_P2_SH=${DIY_P2_SH}" >> $GITHUB_ENV                                     # = DIY_P2_SHçš„å˜é‡
        echo "SSH_ACTIONS=${SSH_ACTIONS}" >> $GITHUB_ENV                                 # = SSHè¿œç¨‹çš„å˜é‡
        echo "UPLOAD_BIN_DIR=${UPLOAD_BIN_DIR}" >> $GITHUB_ENV                           # = æ˜¯å¦ ä¸Šä¼ éƒ½githubç©ºé—´çš„å˜é‡
        echo "UPLOAD_CONFIG=${UPLOAD_CONFIG}" >> $GITHUB_ENV                             # = æ˜¯å¦ å°†â€œ.configé…ç½®æ–‡ä»¶â€ ä¸Šä¼ åˆ°githubç©ºé—´çš„å˜é‡
        echo "UPLOAD_FIRMWARE=${UPLOAD_FIRMWARE}" >> $GITHUB_ENV                         # = æ˜¯å¦ å°†â€œç¼–è¯‘å¥½çš„å›ºä»¶â€ ä¸Šä¼ åˆ°githubç©ºé—´çš„å˜é‡
        echo "UPLOAD_COWTRANSFER=${UPLOAD_COWTRANSFER}" >> $GITHUB_ENV                   # = æ˜¯å¦ å°†â€œç¼–è¯‘å¥½çš„å›ºä»¶â€ ä¸Šä¼ åˆ°å¥¶ç‰›å¿«ä¼ çš„å˜é‡
        echo "UPLOAD_WETRANSFER=${UPLOAD_WETRANSFER}" >> $GITHUB_ENV                     # = æ˜¯å¦ å°†â€œç¼–è¯‘å¥½çš„å›ºä»¶â€ ä¸Šä¼ åˆ°â€œWETRANSFERç½‘ç›˜â€çš„å˜é‡
        echo "UPLOAD_RELEASE=${UPLOAD_RELEASE}" >> $GITHUB_ENV                           # = æ˜¯å¦ å°†â€œç¼–è¯‘å¥½çš„å›ºä»¶â€ å‘å¸ƒåˆ°ä»“åº“ä¸­
        echo "SERVERCHAN_SCKEY=${SERVERCHAN_SCKEY}" >> $GITHUB_ENV                       # = æ˜¯å¦ å¼€å¯å¾®ä¿¡é€šçŸ¥çš„å˜é‡
        
        echo "CangKu=${GITURL##*${Author}/}" >> $GITHUB_ENV                              # = æå–å½“å‰é¡¹ç›®ä»“åº“çš„åç§° å˜é‡
        
        
        
    - name: å‡†å¤‡ç¼–è¯‘_å¾®ä¿¡é€šçŸ¥             ## Githubè®¾ç½®é‡Œéœ€æ·»å¾®ä¿¡SCKEY
      uses: xhnmt/pushplus-action@v1.0.0  ## åŠ è½½æ‰§è¡Œä»“åº“ï¼šhhttps://github.com/xhnmt/pushplus-action
      if: env.SERVERCHAN_SCKEY == 'true' || (github.event.inputs.wxtz == 'wxtz' && github.event.inputs.wxtz  != 'false')
      with:
        token: ${{ secrets.SCKEY }}
        title: "ç¼–è¯‘[${{matrix.target}}]_${{env.CangKu}}ä»“åº“_#${{env.Run_number}}"
        content: "
              
              ä»“åº“åç§°ï¼š${{env.CangKu}}
              
              
              å·¥ä½œæµå·ï¼š#${{env.Run_number}}
              
              
              å›ºä»¶åç§°ï¼š${{matrix.target}}
              
              
              è§¦å‘æ—¶é—´ï¼š${{ env.date1 }}"
              
              
              
## https://github.com/josStorer/get-current-time            è·å–å½“å‰æ—¶é—´
## https://github.com/marketplace/actions/pushplus-action
## https://github.com/xhnmt/pushplus-action



    # - name: å‡†å¤‡ç¼–è¯‘_å¾®ä¿¡é€šçŸ¥             ## Githubè®¾ç½®é‡Œéœ€æ·»å¾®ä¿¡SCKEY
      # uses: emon100/Action-Serverchan@v2  ## åŠ è½½æ‰§è¡Œä»“åº“ï¼šhttps://github.com/emon100/Action-Serverchan
      # if: env.SERVERCHAN_SCKEY == 'true' || (github.event.inputs.wxtz == 'wxtz' && github.event.inputs.wxtz  != 'false')
      # with:
        # SCKEY: ${{ secrets.SCKEY }}
        # text: æ³¨æ„ï¼š${{env.CangKu}}ä»“åº“çš„#${{env.Run_number}}å·[${{matrix.target}}]å¼€å§‹ç¼–è¯‘å•¦ï¼
        # desp: ä¸»äººæ‚¨è¦ç¼–è¯‘çš„[${{matrix.target}}]å›ºä»¶æ­£åœ¨åŠªåŠ›è€•è€˜ä¸­,è¯·è€å¿ƒç­‰å¾…......
              
              
              # ä»“åº“åç§°ï¼š${{env.CangKu}}
              
              
              # å·¥ä½œæµå·ï¼š#${{env.Run_number}}
              
              
              # å›ºä»¶åç§°ï¼š${{matrix.target}}
              


    - name: å®‰è£…ç¼–è¯‘ç¯å¢ƒ                ## Initialization environment
      env:
        DEBIAN_FRONTEND: noninteractive      ## éäº¤äº’æ¨¡å¼
      run: |
        pwd && ls                                                                        # æ˜¾ç¤ºå½“å‰æ­¥éª¤çš„è·¯å¾„å’Œæ‰€æœ‰æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ï¼›
        
        sudo rm -rf /etc/apt/sources.list.d/* /usr/share/dotnet /usr/local/lib/android /opt/ghc
        sudo -E apt-get -qq update -y
        sudo -E apt-get -qq install -y build-essential asciidoc binutils bzip2 gawk gettext git libc6-dev libncurses5 libtinfo-dev libtinfo5 ncurses-doc libncurses5-dev libz-dev patch python3 python2.7 unzip zlib1g-dev lib32gcc1 subversion flex uglifyjs git-core gcc-multilib p7zip p7zip-full msmtp libssl-dev texinfo libglib2.0-dev xmlto qemu-utils upx libelf-dev autoconf automake libtool autopoint device-tree-compiler g++-multilib antlr3 gperf wget curl swig rsync
        sudo -E apt-get -qq autoremove -y --purge
        sudo -E apt-get -qq clean -y
        sudo timedatectl set-timezone "$TZ"
        sudo mkdir -p /workdir                         # æ ¹ç›®å½•ä¸‹æ–°å»ºâ€œworkdirâ€ç›®å½•ï¼Œç”¨äºä¸‹è½½å­˜æ”¾æºç 
        sudo chown $USER:$GROUPS /workdir              # æé«˜â€œworkdirâ€ç›®å½•çš„æƒé™
        sudo -E apt-get -qq install xz-utils btrfs-progs zip dosfstools uuid-runtime pigz         # N1å›ºä»¶æ‰“åŒ…å¿…éœ€è¦çš„ä¾èµ–
        
        
    - name: é‡Šæ”¾ Ubuntu ç£ç›˜ç©ºé—´        ## Free Disk Space (Ubuntu) ï¼ˆé¢„è®¡é‡Šæ”¾31GBç©ºé—´ï¼‰
      uses: jlumbroso/free-disk-space@main             ## åŠ è½½æ‰§è¡Œä»“åº“ï¼šhttps://github.com/jlumbroso/free-disk-space
      with:
        tool-cache: true
        android: true
        dotnet: true
        haskell: true
        large-packages: true
        swap-storage: true
        
    - name: ä¸‹è½½${{matrix.target}}æºç                  ## Clone source code
      working-directory: /workdir                      ## æºç æŒ‡å®šä¸‹è½½åˆ°æ ¹ç›®å½•ä¸‹æ–°å»ºçš„â€œworkdirâ€ç›®å½•ï¼Œ
      run: |
        pwd && ls                                                     # æ˜¾ç¤ºå½“å‰æ­¥éª¤çš„è·¯å¾„å’Œæ‰€æœ‰æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ï¼›
        
        df -hT $PWD                                                   # æ˜¾ç¤ºå½“å‰ç£ç›˜ä½¿ç”¨æƒ…å†µ
        git clone $REPO_URL -b $REPO_BRANCH openwrt                   # ä¸‹è½½æºç ï¼Œå¹¶æ”¹ä¸ºé»˜è®¤ç›®å½•â€œopenwrtâ€
        ln -sf /workdir/openwrt $GITHUB_WORKSPACE/openwrt             # /æ ¹ç›®å½•ä¸‹workdir/openwrtç›®å½•å¼ºåˆ¶å»ºç«‹è½¯è¿æ¥åˆ°  ä¸»ä»“åº“ç›®å½•ä¸‹ openwrt ç›®å½•ï¼›
        
        cd openwrt                                                                      # é¦–æ¬¡è¿›å…¥æºç  çš„æ‰§è¡Œç›®å½•â€œopenwrtâ€
        
        # if [ ${{matrix.target}} != openwrt ]; then                                    # å½“ç¼–è¯‘â€œopenwrtâ€çº¯å‡€æœºå‹æ—¶ï¼Œå…ˆåˆ é™¤è¿™äº›æ–‡ä»¶å¤¹
          # rm -rf package/lienol/luci-app-timecontrol
          # rm -rf package/ntlf9t/{smartdns,luci-app-smartdns}
          # rm -rf package/ctcgfw/{luci-app-argon-config,luci-theme-argonv3}
          # rm -rf package/lean/{luci-app-netdata,luci-theme-argon,k3screenctrl}
        # fi
        
        rm -rf {LICENSE,README,README.md}
        rm -rf ./*/{LICENSE,README,README.md}
        rm -rf ./*/*/{LICENSE,README,README.md}    # åˆ é™¤æ— ç”¨è¯´æ˜
        
        
        
    - name: æ¸…ç†ç¼“å­˜                           ## Cache                                    ## æ¸…ç†ç¼“å­˜
      uses: klever1988/cachewrtbuild@main            ## åŠ è½½æ‰§è¡Œä»“åº“ï¼šhttps://github.com/stupidloud/cachewrtbuild
      with:
          ccache: 'true'
          mixkey: 'x86'
          prefix: 'openwrt'
          
          
          
    - name: åŠ è½½DIY_1è„šæœ¬                              ## Load custom feeds
      run: |
        pwd && ls                                      # æ˜¾ç¤ºå½“å‰æ­¥éª¤çš„è·¯å¾„å’Œæ‰€æœ‰æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ï¼›
        
        #if [ ${{matrix.target}} == "lede_N1" -o ${{matrix.target}} == "Project_N1" ];then           # å½“ç¼–è¯‘ N1æœºå‹æ—¶_ä¸‹è½½åœ¨çº¿æ‰“åŒ…ä¾èµ–ï¼ˆç›®å‰å·²ç»åˆ åº“ï¼‰
        #  git clone https://github.com/tuanqing/mknop reform
        #fi
        
        
        # https://github.com/unifreq/openwrt_packit    # N1æ‰“åŒ…æºç ï¼Œæœªæµ‹è¯•   https://github.com/wxfyes/N1packaging/releases
        
        
        cp -Rf `find ./ -maxdepth 1 -type d ! -path './openwrt' ! -path './'` openwrt               # å¤åˆ¶å½“å‰ build â€œç­‰æ‰€æœ‰æ–‡ä»¶â€ è‡³ openwrtç›®å½•ä¸‹                                 å¤åˆ¶å½“å‰ â€œç¼–è¯‘æœºå‹â€ å†…çš„æ‰€æœ‰DIYæ–‡ä»¶ è‡³openwrtç›®å½•ä¸‹
        cd openwrt                                                                                  # å†æ¬¡è¿›å…¥æºç  çš„æ‰§è¡Œç›®å½•â€œopenwrtâ€
        
        if [ -f "build/${{matrix.target}}/$DIY_P1_SH" ]; then                # æ‰§è¡ŒDIY_1è„šæœ¬ï¼ï¼ï¼
          chmod +x build/${{matrix.target}}/$DIY_P1_SH
          /bin/bash "build/${{matrix.target}}/$DIY_P1_SH"
        fi
        
        
        
        
        
        # if [ ${{matrix.target}} != "openwrt" ]; then                       # å½“ç¼–è¯‘â€œopenwrtâ€çº¯å‡€æœºå‹æ—¶ï¼Œä¸‹è½½openwrt-packageæ’ä»¶åŒ…
          # git clone -b $REPO_BRANCH --single-branch https://github.com/281677160/openwrt-package package/danshui
        # fi
        

        
        
# #ä¿®å¤mt76æ— çº¿é©±åŠ¨ç¨‹åº
# pushd package/kernel/mt76
# sed -i '/mt7662u_rom_patch.bin/a\\techo mt76-usb disable_usb_sg=1 > $\(1\)\/etc\/modules.d\/mt76-usb' Makefile
# popd



    - name: åŠ è½½DIY_2è„šæœ¬                    ## Load custom configuration
      run: |
        pwd && ls                            # æ˜¾ç¤ºå½“å‰æ­¥éª¤çš„è·¯å¾„å’Œæ‰€æœ‰æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ï¼›
        
        cd openwrt                           # å› ä¸ºæ‰§è¡Œå·¥ä½œç›®å½•åœ¨ä¸Šçº§â€œworkdirâ€ï¼Œæ¯ä¸€æ­¥å¿…é¡»è¿›å…¥openwrtæºç ç›®å½•
        
        if [ -f "build/${{matrix.target}}/$DIY_P2_SH" ]; then                                      # æ‰§è¡ŒDIY_2è„šæœ¬
          chmod +x build/${{matrix.target}}/$DIY_P2_SH
          /bin/bash "build/${{matrix.target}}/$DIY_P2_SH"
        fi
        
        if [ -n "$(ls -A "build/${{matrix.target}}/diy" 2>/dev/null)" ]; then                      # å¤åˆ¶ ç¼–è¯‘æœºå‹ç›®å½•å†…çš„â€œdiyâ€æ–‡ä»¶åˆ°openwrtæºç å†…
         cp -Rf build/${{matrix.target}}/diy/* ./
        fi
        
        if [ -n "$(ls -A "build/${{matrix.target}}/files" 2>/dev/null)" ]; then                    # å¤åˆ¶ ç¼–è¯‘æœºå‹ç›®å½•å†…çš„â€œfilesâ€æ–‡ä»¶åˆ°openwrtæºç å†…
         cp -rf build/${{matrix.target}}/files files
         chmod -R 777 build/${{matrix.target}}/files/* ./
        fi
        
        if [ -n "$(ls -A "build/${{matrix.target}}/patches" 2>/dev/null)" ]; then                  # å¤åˆ¶ ç¼–è¯‘æœºå‹ç›®å½•å†…çš„â€œpatchesâ€æ–‡ä»¶åˆ°openwrtæºç å†…
          find "build/${{matrix.target}}/patches" -type f -name '*.patch' -print0 | sort -z | xargs -I % -t -0 -n 1 sh -c "cat '%'  | patch -d './' -p1 --forward --no-backup-if-mismatch"
        fi
        
        [ -e build/${{matrix.target}}/$CONFIG_FILE ]                                               # ç§»åŠ¨ ç¼–è¯‘æœºå‹ç›®å½•å†…çš„â€œ.configâ€æ–‡ä»¶åˆ°openwrtæºç å†…
        mv build/${{matrix.target}}/$CONFIG_FILE .config
        
        if [ $REPO_URL == "https://github.com/coolsnowwolf/lede" ]; then                           # å½“ä½¿ç”¨Ledeæºç æ—¶ï¼Œå˜é‡ï¼šNAME2=Lede   ZUOZHE=lean
         echo "NAME2=Lede_" >> $GITHUB_ENV
         echo "ZUOZHE=lean" >> $GITHUB_ENV
        elif [ $REPO_URL == "https://github.com/Lienol/openwrt" ]; then                            # å½“ä½¿ç”¨Lienolæºç æ—¶ å˜é‡ï¼šNAME2=Lienol   ZUOZHE=lienol
         echo "NAME2=Lienol_" >> $GITHUB_ENV
         echo "ZUOZHE=lienol" >> $GITHUB_ENV
        elif [ $REPO_URL == "https://github.com/project-openwrt/openwrt" ]; then                   # å½“ä½¿ç”¨Projectæºç æ—¶ å˜é‡ï¼šNAME2=Project   ZUOZHE=CTCGFW
         echo "NAME2=Project_" >> $GITHUB_ENV
         echo "ZUOZHE=CTCGFW" >> $GITHUB_ENV
        elif [ $REPO_URL == "https://github.com/openwrt/openwrt" ]; then                           # å½“ä½¿ç”¨å®˜æ–¹æºç æ—¶ å˜é‡ï¼šNAME2=Official
         echo "NAME2=Official_" >> $GITHUB_ENV
        fi
        
        

#-----------------------------------------------------------------------------------------------------------------
    # - name: Apply patches #patchè¡¥ä¸
      # run: |
        # cd openwrt
        # find "devices/common/patches" -type f ! -path 'devices/common/patches/china_mirrors.patch' -name '*.patch' -print0 | sort -z | xargs -I % -t -0 -n 1 sh -c "cat '%'  | patch -d './' -p1 -E --forward --no-backup-if-mismatch"
#-----------------------------------------------------------------------------------------------------------------

    # - name: å‡çº§ Goç‰ˆæœ¬
      # run: |
        # cd openwrt && rm -rf feeds/packages/lang/golang
        # git clone https://github.com/sbwml/packages_lang_golang -b 22.x feeds/packages/lang/golang
        
        
        
    - name: SSHé“¾æ¥ï¼ˆåˆ°æ­¤é¢„è®¡10åˆ†é’Ÿï¼‰             ## SSH connection to Actions
      uses: P3TERX/ssh2actions@main               ## https://github.com/P3TERX/ssh2actions
      if: (github.event.inputs.ssh == 'true' && github.event.inputs.ssh  != 'false') || contains(github.event.action, 'ssh')
      env:
        TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        
        
        
    - name: SSHä¸Šä¼ .configé…ç½®æ–‡ä»¶              ## ä¸Šä¼ åˆ°githubç©ºé—´
      uses: actions/upload-artifact@v4       ## https://github.com/actions/upload-artifact
      if: (github.event.inputs.ssh == 'true' && github.event.inputs.ssh  != 'false') || contains(github.event.action, 'ssh')
      with:
        name: SSH.config
        path: openwrt/.config
        
        
    - name: ä¸‹è½½DLåº“                             ## Download package
      id: package
      run: |
        pwd && ls                                # æ˜¾ç¤ºå½“å‰æ­¥éª¤çš„è·¯å¾„å’Œæ‰€æœ‰æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ï¼›
        
        cd openwrt                               # å› ä¸ºæ‰§è¡Œå·¥ä½œç›®å½•åœ¨ä¸Šçº§â€œworkdirâ€ï¼Œæ¯ä¸€æ­¥å¿…é¡»è¿›å…¥openwrtæºç ç›®å½•
        
        make defconfig                           # è‡ªåŠ¨ç”Ÿæˆ.configæ–‡ä»¶
        make download -j$(nproc)                 # å…¨çº¿ç¨‹ä¸‹è½½DLåº“
        
        find dl -size -1024c -exec ls -l {} \;   # æ£€æŸ¥å°äº1KBæ–‡ä»¶
        find dl -size -1024c -exec rm -f {} \;   # åˆ é™¤å°äº1KBæ–‡ä»¶
        
        make download -j4                        # å†æ¬¡æ‰§è¡Œä¸‹è½½DLåº“
        
        
        
    - name: å¼€å§‹ç¼–è¯‘å›ºä»¶                         ## Compile the firmware
      id: compile
      run: |
        pwd && ls                                # æ˜¾ç¤ºå½“å‰æ­¥éª¤çš„è·¯å¾„å’Œæ‰€æœ‰æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ï¼›
        
        cd openwrt                               # å› ä¸ºæ‰§è¡Œå·¥ä½œç›®å½•åœ¨ä¸Šçº§â€œworkdirâ€ï¼Œæ¯ä¸€æ­¥å¿…é¡»è¿›å…¥openwrtæºç ç›®å½•
                
        echo -e "CPUçº¿ç¨‹æ•°ï¼š$(nproc)   è¿›è¡Œå…¨çº¿ç¨‹ç¼–è¯‘..."           # æ˜¾ç¤ºå½“å‰CPUå¤šå°‘çº¿ç¨‹ï¼›å‘½ä»¤äºŒï¼šecho -e "$(($(nproc)+1)) çº¿ç¨‹ç¼–è¯‘"
        make -j$(nproc) V=s || make -j1 V=s                          # å…ˆè¿›è¡Œå…¨é€Ÿçº¿ç¨‹ç¼–è¯‘ï¼Œå¦‚æœæŠ¥é”™å†è¿›è¡Œå•çº¿ç¨‹ç¼–è¯‘æ’æŸ¥é”™è¯¯ï¼
        
        
        # echo "::set-output name=status::success"         # å·²ç»å¼ƒç”¨
        echo "status=success" >> $GITHUB_OUTPUT             # æ–°ä»£ç    GitHub è¾“å‡ºå˜é‡
        
        DEVICE=$(egrep -o "CONFIG_TARGET.*DEVICE.*=y" .config | sed -r 's/.*(.*)=y/\0/')            # DEVICE  = å›ºä»¶æœºå‹çš„å˜é‡ï¼ˆåœ¨.configé…ç½®æ–‡ä»¶ä¸­å¾—å‡ºï¼‰
        DEVICE2=$(egrep -o "CONFIG_TARGET.*_64_Generic=y" .config | sed -r 's/.*(.*)=y/\0/')        # DEVICE2 = å›ºä»¶å¹³å°çš„å˜é‡ï¼ˆåœ¨.configé…ç½®æ–‡ä»¶ä¸­å¾—å‡ºï¼‰å¦‚ï¼šX86ã€
        
        if [ $DEVICE == "CONFIG_TARGET_x86_64_DEVICE_generic=y" ]; then                             # å½“å›ºä»¶æœºå‹å«genericæ—¶ï¼Œè¾“å‡ºå˜é‡=      å°å†™generic = DEVICE å˜é‡ /= NAME1 ï¼ˆå›ºä»¶å¹³å°â€œx86-64â€ï¼‰
         echo "NAME1=x86-64" >> $GITHUB_ENV
        elif [ $DEVICE2 == "CONFIG_TARGET_x86_64_Generic=y" ]; then                                 # å½“å›ºä»¶æœºå‹å«Genericæ—¶ï¼Œè¾“å‡ºå˜é‡=      å¤§å†™Generic= DEVICE2 å˜é‡ /= NAME1 ï¼ˆå›ºä»¶å¹³å°â€œx86-64â€ï¼‰
         echo "NAME1=x86-64" >> $GITHUB_ENV
        elif [ ${{matrix.target}} == "lede_N1" -o ${{matrix.target}} == "Project_N1" ];then         # å½“ç¼–è¯‘N1æœºå‹ç›®å½•æ—¶ï¼Œè¾“å‡ºå˜é‡=          N1çš„æ‰§è¡Œåˆ¤æ–­ / NAME1 = â€œn1,Vplus,Beikeyun,L1Pro,S9xxxâ€
         echo "NAME1=n1,Vplus,Beikeyun,L1Pro,S9xxx" >> $GITHUB_ENV
        elif [ $DEVICE != "CONFIG_TARGET_x86_64_DEVICE_generic=y" ]; then                           # æ²¡æœ‰â€œx86-64â€æ—¶ = NAME1 /= â€œDEVICE_â€å­—ç¬¦ååç§°ï¼ˆå¦‚ç«æ–—äº‘ï¼šp2w_r619ac-128mï¼‰
         grep '^CONFIG_TARGET.*DEVICE.*=y' .config | sed -r 's/.*DEVICE_(.*)=y/\1/' > NAME1
         [ -s NAME1 ] && echo "NAME1=$(cat NAME1)" >> $GITHUB_ENV
        fi                                                                                          # NAME1 = x86-64ï¼ˆä¸DEVICE_NAMEå˜é‡å¯¹ç­‰=æå–æ˜¯â€œgenericâ€ï¼‰
        
        echo "date=$(date "+%Y.%m.%d-%H%M")" >> $GITHUB_ENV                     # = date å˜é‡æ—¶é—´æ ¼å¼: 2021.01.02-1310
        echo "date1=$(date "+%Yå¹´%mæœˆ%då·-%Hç‚¹%Måˆ†")" >> $GITHUB_ENV           # = date1 å˜é‡æ—¶é—´æ ¼å¼: 2021å¹´01æœˆ02å·-13ç‚¹10åˆ† ï¼ˆReleasesä¸»é¡µæ˜¾ç¤ºï¼‰
        echo "date2=$(date +"%Y.%m.%d-%H%M")" >> $GITHUB_ENV                    # = date2 å˜é‡æ—¶é—´æ ¼å¼ï¼š2021.01.02-1310ï¼ˆä¸FILE_DATEå¯¹ç­‰ï¼‰Tagsæ˜¾ç¤º



    - name: æ£€æŸ¥ç©ºé—´ä½¿ç”¨æƒ…å†µ                     ## Check space usage
      if: (!cancelled())
      run: df -hT



    - name: ä¸Šä¼ binç›®å½•(æ‰“åŒ…_å›ºä»¶+ipk)              ## Upload bin directory
      uses: actions/upload-artifact@v4              ## https://github.com/actions/upload-artifact
      if: steps.compile.outputs.status == 'success' && env.UPLOAD_BIN_DIR == 'true'
      with:
        name: Bin_${{ env.NAME2 }}${{ env.NAME1 }}_${{ env.date }}     # æ–‡ä»¶åç§°
        path: openwrt/bin   # æ–‡ä»¶è·¯å¾„


    # - name: N1äº‘è„šæœ¬æ‰“åŒ…    # å°† Armvirt æ‰“åŒ…ä¸º OpenWrt
      # uses: ophub/flippy-openwrt-actions@main     ## https://github.com/ophub/flippy-openwrt-actions
      # env:
        # OPENWRT_ARMVIRT: openwrt/bin/targets/*/*/*rootfs.tar.gz     # N1ç¼–è¯‘å›ºä»¶è·¯å¾„
        # PACKAGE_SOC: s905d                                    # ç›’å­å‹å·ï¼Œé»˜è®¤åªæ˜¯N1
        # KERNEL_VERSION_NAME: 6.1.79                           # å†…æ ¸ç‰ˆæœ¬
        # WHOAMI: huangqian8                                    # ä½œè€…è‘—åï¼Œ

        # https://github.com/ophub/flippy-openwrt-actions/blob/main/README.cn.md    # N1äº‘è„šæœ¬æ‰“åŒ…



    - name: ç¼–è¯‘N1æœºå‹æ—¶,æ‰“åŒ…ï¼ˆN1ã€å¾®åŠ äº‘ã€è´å£³äº‘ã€æˆ‘å®¶äº‘ã€S9xxxï¼‰å›ºä»¶
      run: |
        pwd && ls                                               # æ˜¾ç¤ºå½“å‰æ­¥éª¤çš„è·¯å¾„å’Œæ‰€æœ‰æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ï¼›
        
        # if [ ${{matrix.target}} == "lede_N1" -o ${{matrix.target}} == "Project_N1" ];then             # å½“ç¼–è¯‘N1æœºå‹ç›®å½•æ—¶ï¼Œå¤åˆ¶N1å›ºä»¶åˆ°æ‰“åŒ…ç›®å½•ä¸‹ï¼Œ
         # cp openwrt/bin/targets/armvirt/*/*.tar.gz reform/openwrt                                     # å¤åˆ¶è¦æ‰“åŒ…çš„æ–‡ä»¶è‡³ reform/openwrt ç›®å½•å†…
        
         # cd reform
         # sudo ./gen_openwrt -d -k latest                                                              # è¿›å…¥æ‰“åŒ…æºç ç›®å½•å†…ï¼Œç„¶åæ‰§è¡ŒN1æ‰“åŒ…è„šæœ¬
         
         # devices=("phicomm-n1" "rk3328" "s9xxx" "vplus")
         # cd out
         # for x in ${devices[*]}; do
           # cd $x
           # filename=$(ls | awk -F '.img' '{print $1}')
           # gzip *.img
           # cd ../
           # echo "firmware_$x=$filename" >> $GITHUB_ENV
         # done
           # cd ../../
           # mv -f reform/out/*/*.img.gz openwrt/bin/targets/armvirt/*                                  # ç§»åŠ¨N1æœºå‹å›ºä»¶åˆ°é»˜è®¤binç›®å½•ä¸‹
        # fi
        
        
        
        
        
        
        if [ ${{matrix.target}} == "lede_N1" -o ${{matrix.target}} == "Project_N1" ];then
            git clone https://github.com/wxfyes/N1packaging.git N1opt                                 # ä¸‹è½½N1æ‰“åŒ…æºç 
            sudo chmod  -R 777 /opt                  ## æ ¹ç›®å½•ä¸‹çš„optç›®å½• ææƒ777
            find N1opt/70+o/opt/* -name "*kernel*" | xargs -i cp -r {} /opt                                  ## å¯»æ‰¾"kernel" æ–‡ä»¶å¤¹å¹¶å¤åˆ¶è‡³ æ ¹ç›®å½•ä¸‹çš„/optç›®å½•å†…
            cp -r openwrt/bin/targets/*/*/*.tar.gz /opt/kernel/openwrt-armvirt-64-default-rootfs.tar.gz      ## å¤åˆ¶N1å›ºä»¶è‡³æ ¹ç›®å½•ä¸‹çš„/opt/kernelç›®å½•å†… å¹¶é‡å‘½åä¸ºopenwrt-armvirt-64-default-rootfs.tar.gz
            cd /opt/kernel
            sudo chmod  -R 777 /opt                  ## æ ¹ç›®å½•ä¸‹çš„optç›®å½• ææƒ777
            sudo chmod +x *.sh                       ## å½“å‰æ‰€æœ‰è„šæœ¬æå¯æ‰§è¡Œæƒé™
            sudo ./mk_s905d_n1.sh                    ## æ‰§è¡ŒN1æ‰“åŒ…è„šæœ¬
            sudo cp files/update-amlogic-openwrt.sh tmp/update-amlogic-openwrt.sh        ## å¤åˆ¶æ›´æ–°è„šæœ¬
            sudo chmod -R 777 tmp                    ## ææƒtmpç›®å½•
            cd tmp                                   ## è¿›å…¥tmpç›®å½•
            sudo pigz -9 N1-wangxiaofeng-70+o.img    ## å‹ç¼©N1å›ºä»¶
            mv *.img.gz -t $GITHUB_WORKSPACE/openwrt/bin/targets/armvirt/*              ## ç§»åŠ¨å›ºä»¶è‡³ æºarmvirtç›®å½•å†…
            mv *.sh -t $GITHUB_WORKSPACE/openwrt/bin/targets/armvirt/*                  ## ç§»åŠ¨æ›´æ–°è„šæœ¬è‡³ æºarmvirtç›®å½•å†…
            cd $GITHUB_WORKSPACE     # è¿›å…¥ä»“åº“æ‰§è¡Œç›®å½•
            rm -rf N1opt             # å·²æ‰“åŒ…å®Œæˆï¼Œåˆ é™¤æ‰“åŒ…ç›®å½•
            
        else
            echo "***N1packagingæºç ç›®å½•å·²å­˜åœ¨***"
        
            
        fi
        
        
        # echo "::set-output name=status::success"   # è¢«å¼ƒç”¨
        echo "status=success" >>$GITHUB_OUTPUT       #  æ–°å‘½ä»¤  GitHub ç»“æœè¾“å‡ºå˜é‡

    - name: æ•´ç†æ–‡ä»¶                           ## Organize files
      id: organizer
      run: |
        pwd && ls                              # æ˜¾ç¤ºå½“å‰æ­¥éª¤çš„è·¯å¾„å’Œæ‰€æœ‰æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ï¼›
        
        mkdir config                                                                                  # åˆ›å»ºconfigæ–‡ä»¶å¤¹
        find openwrt/bin/targets/ -name "*config.buildinfo*" | xargs -i mv -f {} config               # å¯»æ‰¾â€œconfig.buildinfoâ€æ–‡ä»¶ç§»åŠ¨å¹¶æ”¹åä¸º"config"
        
        if [ -n "$(ls -A "openwrt/bin/targets/x86" 2>/dev/null)" ]; then                              # å¯»æ‰¾â€œkernelâ€æ–‡ä»¶ å¹¶ç§»åŠ¨è‡³targetsç›®å½•å†…
         find openwrt/bin/targets/x86/* -name "*kernel*" | xargs -i mv -f {} openwrt/bin/targets
        fi
        
        cd openwrt/bin/targets/*/*                                                                     # åˆ‡æ¢åˆ°å›ºä»¶ç›®å½•ä¸‹
        
        rm -rf packages && mkdir packages                                                              # åˆ é™¤â€œpackagesâ€æ–‡ä»¶å¤¹ï¼Œé‡æ–°åˆ›å»ºâ€œpackagesâ€æ–‡ä»¶å¤¹ï¼ˆæŠŠè¿™ä¸ªæ–‡ä»¶ç›®å½•åšä¸ºæ”¾å›ºä»¶çš„è·³æ¿ï¼‰
        find -name "*buildinfo*" | xargs -i mv -f {} packages                                          # å¯»æ‰¾â€œbuildinfoâ€å¹¶ç§»åŠ¨è‡³é‡å»ºçš„â€œpackagesâ€æ–‡ä»¶å¤¹å†…
        find -name "*sha256sums*" | xargs -i mv -f {} packages                                         # å¯»æ‰¾â€œsha256sumsâ€å¹¶ç§»åŠ¨è‡³é‡å»ºçš„â€œpackagesâ€æ–‡ä»¶å¤¹å†…
        find -name "*manifest*" | xargs -i mv -f {} packages                                           # å¯»æ‰¾â€œmanifestâ€å¹¶ç§»åŠ¨è‡³é‡å»ºçš„â€œpackagesâ€æ–‡ä»¶å¤¹å†…
        find -name "*vmlinuz*" | xargs -i mv -f {} packages                                            # å¯»æ‰¾â€œvmlinuzâ€å¹¶ç§»åŠ¨è‡³é‡å»ºçš„â€œpackagesâ€æ–‡ä»¶å¤¹å†…
        find -name "*Image*" | xargs -i mv -f {} packages                                              # å¯»æ‰¾â€œImageâ€å¹¶ç§»åŠ¨è‡³é‡å»ºçš„â€œpackagesâ€æ–‡ä»¶å¤¹å†…
        find -name "*profiles*" | xargs -i mv -f {} packages                                           # å¯»æ‰¾â€œprofilesâ€å¹¶ç§»åŠ¨è‡³é‡å»ºçš„â€œpackagesâ€æ–‡ä»¶å¤¹å†…
        rm -rf packages                                                                                # åˆ é™¤â€œpackagesâ€æ–‡ä»¶å¤¹
        
        echo "FIRMWARE=$PWD" >> $GITHUB_ENV                                                            # = $PWDå‘½ä»¤ï¼Œè¾“å‡ºçš„ç›®å½• å˜é‡ä¸ºï¼šFIRMWARE
        
        # echo "::set-output name=status::success"                                                       # è¢«å¼ƒç”¨  åˆ—å‡ºæ–‡ä»¶å¤¹å†… æ‰€æœ‰åç§°
        echo "status=success" >>$GITHUB_OUTPUT                                                         #  æ–°å‘½ä»¤  GitHub ç»“æœè¾“å‡ºå˜é‡



    - name: ä¸Šä¼ .configé…ç½®æ–‡ä»¶              ## ä¸Šä¼ åˆ°githubç©ºé—´
      uses: actions/upload-artifact@v4       ## https://github.com/actions/upload-artifact
      if: steps.organizer.outputs.status == 'success' && env.UPLOAD_CONFIG == 'true' && !cancelled()
      with:
        name: .config_${{ env.NAME2 }}${{ env.NAME1 }}
        path: ./config              # config/.config ç¬¬20æ¬¡



    - name: ä¸Šä¼ å›ºä»¶åˆ°githubç©ºé—´             ## Upload firmware directory
      uses: actions/upload-artifact@main     ## https://github.com/actions/upload-artifact
      if: steps.organizer.outputs.status == 'success' && env.UPLOAD_FIRMWARE == 'true'
      with:
        name: firmware_${{ env.NAME2 }}${{ env.NAME1 }}_${{ env.date }}
        path: ${{ env.FIRMWARE }}            ## ä¸Šä¼ ç¼–è¯‘ååˆ—è¡¨ä¸­çš„å›ºä»¶



    - name: ä¸Šä¼ å›ºä»¶åˆ°å¥¶ç‰›å¿«ä¼                ## Upload firmware to cowtransfer ï¼ˆå·²å¤±æ•ˆï¼Œéœ€è¦ç™»å½•æ‰èƒ½ä¸Šä¼ ï¼‰
      id: cowtransfer
      if: steps.organizer.outputs.status == 'success' && env.UPLOAD_COWTRANSFER == 'true' && !cancelled()
      run: |
        # pwd && ls                            # æ˜¾ç¤ºå½“å‰æ­¥éª¤çš„è·¯å¾„å’Œæ‰€æœ‰æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ï¼›
                
        
        curl -fsSL https://git.io/file-transfer | sh                                                     ## ä¸‹è½½æ‰§è¡Œè„šæœ¬   é¡¹ç›®ä»“åº“ï¼šhttps://github.com/Mikubill/transfer
        
        ## -f=è¿æ¥å¤±è´¥æ—¶ä¸æ˜¾ç¤ºhttpé”™è¯¯  s=é™éŸ³æ¨¡å¼ã€‚ä¸è¾“å‡ºä»»ä½•ä¸œè¥¿    S=åªè¾“å‡ºé”™è¯¯ä¿¡æ¯ï¼ˆé€šå¸¸ä¸-så…±ç”¨ï¼‰   -L=ä¼šè®© HTTP è¯·æ±‚è·ŸéšæœåŠ¡å™¨çš„é‡å®šå‘ã€‚curl é»˜è®¤ä¸è·Ÿéšé‡å®šå‘ã€‚
        ./transfer cow --block 2621440 -s -p 64 --no-progress ${FIRMWARE} 2>&1 | tee cowtransfer.log
        
        pwd && ls   
        cat cowtransfer.log
        
        echo "::warning file=å¥¶ç‰›å¿«ä¼ ï¼ˆ${{matrix.target}}ï¼‰::$(cat cowtransfer.log | grep https)"
        echo "url=$(cat cowtransfer.log | grep https | cut -f3 -d" ")" >> $GITHUB_OUTPUT
        
        
        
        
        # curl -fsSL git.io/file-transfer | sh
        # ./transfer cow --block 2621440 -s -p 64 --no-progress ${FIRMWARE} 2>&1 | tee cowtransfer.log
        # echo "::warning file=å¥¶ç‰›å¿«ä¼ ï¼ˆ${{matrix.target}}ï¼‰::$(cat cowtransfer.log | grep https)"
        # echo "::set-output name=url::$(cat cowtransfer.log | grep https | cut -f3 -d" ")"     # è¢«å¼ƒç”¨      ## è§£å†³æ–¹æ³•ï¼šhttps://github.blog/changelog/2022-10-11-github-actions-deprecating-save-state-and-set-output-commands/
        # set-outputè¢«å¼ƒç”¨è§£å†³æ–¹æ³•ï¼š https://www.right.com.cn/forum/thread-8271912-1-1.html
        
        
        
    - name: ä¸Šä¼ å›ºä»¶åˆ°WeTransfer             ## Upload firmware to WeTransfer
      id: wetransfer
      if: steps.organizer.outputs.status == 'success' && env.UPLOAD_WETRANSFER == 'true' && !cancelled()
      run: |
        pwd && ls                            # æ˜¾ç¤ºå½“å‰æ­¥éª¤çš„è·¯å¾„å’Œæ‰€æœ‰æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ï¼›
        
        curl -fsSL https://git.io/file-transfer | sh
        ./transfer wet -s -p 16 --no-progress ${FIRMWARE} 2>&1 | tee wetransfer.log
        echo "::warning file=WeTransferé“¾æ¥ï¼ˆ${{matrix.target}}ï¼‰::$(cat wetransfer.log | grep https)"
        echo "url=$(cat wetransfer.log | grep https | cut -f3 -d" ")" >> $GITHUB_OUTPUT



    - name: æå–ã€Œå¥¶ç‰›å¿«ä¼ ã€&ã€ŒWeTransferã€ä¸‹è½½é“¾æ¥       ## è‡ªåŠ¨æå–é“¾æ¥
      if: steps.organizer.outputs.status == 'success' && env.UPLOAD_RELEASE == 'true' && !cancelled()
      run: |
        pwd && ls                            # æ˜¾ç¤ºå½“å‰æ­¥éª¤çš„è·¯å¾„å’Œæ‰€æœ‰æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ï¼›
        
        curl -fsSL git.io/file-transfer | sh
        ./transfer cow --block 2621440 -s -p 64 --no-progress ${FIRMWARE} 2>&1 | tee cowtransfer.log
        
        echo "COWTRANSFER_URL=$(cat cowtransfer.log | grep https | cut -f3 -d" ")" >> $GITHUB_ENV
        
        curl -fsSL git.io/file-transfer | sh
        ./transfer wet -s -p 16 --no-progress ${FIRMWARE} 2>&1 | tee wetransfer.log
        
        echo "WETRANSFER_URL=$(cat wetransfer.log | grep https | cut -f3 -d" ")" >> $GITHUB_ENV



#--------------------------------------------
#    - name: ç”Ÿæˆå‘å¸ƒæ ‡ç­¾ #Generate release tag
#      id: tag
#      if: env.UPLOAD_RELEASE == 'true' && !cancelled()
#      run: |
#        echo "::set-output name=release_tag::$(date +"%Y.%m.%d-%H%M")"
#        touch release.txt
#        [ $UPLOAD_COWTRANSFER = true ] && echo "ğŸ”— [Cowtransfer](${{ steps.cowtransfer.outputs.url }})" >> release.txt
#        [ $UPLOAD_WETRANSFER = true ] && echo "ğŸ”— [WeTransfer](${{ steps.wetransfer.outputs.url }})" >> release.txt
#        echo "::set-output name=status::success"
#--------------------------------------------



    - name: å‘å¸ƒå›ºä»¶                         ## è‡ªåŠ¨å‘å¸ƒå›ºä»¶ releasesä¸»é¡µä¸‹è½½
      uses: softprops/action-gh-release@v2   ## https://github.com/softprops/action-gh-release
      if: steps.organizer.outputs.status == 'success' && env.UPLOAD_RELEASE == 'true' && !cancelled()
      env:
        GITHUB_TOKEN: ${{ secrets.REPO_TOKEN }}
      with:
        name: ${{ env.date1 }} ã€Œ ${{matrix.target}} ã€å›ºä»¶#${{env.Run_number}}        ## æœ€å¤§å­—å·çš„æ ‡é¢˜
        tag_name: ${{ env.date2 }}           ## å·¦ä¾§æ ‡ç­¾é¡µæ—¶é—´
        body: |                              ## æ–‡æœ¬æ˜¾ç¤º
            â˜†  æºç  : ${{ env.REPO_URL }}
            â˜†  åˆ†æ”¯ : ${{ env.REPO_BRANCH }}
            â˜†  æ„Ÿè°¢æºç ä½œè€…[ ${{ env.ZUOZHE }}å¤§ç¥ ]æ— ç§åˆ†äº«ï¼
            
            ğŸ‰ [ ${{matrix.target}} ]å›ºä»¶ä¸‹è½½ âœ¨
            -
            ğŸ’ å¥¶ç‰›å¿«ä¼ (å›½å†…é«˜é€ŸğŸš€ä¸‹è½½)ï¼š ${{ env.COWTRANSFER_URL }}
            
            â›„ WeTransfer(å›½å¤–é«˜é€ŸğŸš€ä¸‹è½½)ï¼š ${{ env.WETRANSFER_URL }}
            
            ğŸŒ´ é“¾æ¥æœ‰æ•ˆæœŸä¸º7å¤©ï¼Œæ— éœ€æ³¨å†Œç›´æ¥ä¸‹è½½ ğŸ¤
        files: ${{ env.FIRMWARE }}/*         ## ä¸Šä¼ ç”Ÿæˆçš„æ‰€æœ‰å›ºä»¶



    - name: åˆ é™¤å·¥ä½œæµè¿è¡Œ                            ## Delete workflow runs
      uses: Mattraks/delete-workflow-runs@main        ## GitRML/delete-workflow-runs@v2 å·²ç»åœæ›´     æ”¹ä¸ºï¼š https://github.com/Mattraks/delete-workflow-runs
      with:
        token: ${{ secrets.REPO_TOKEN }}
        repository: ${{ github.repository }}
        retain_days: 10           ## ä¿ç•™å¤©æ•°ï¼ˆé»˜è®¤æ˜¯1ï¼‰
        keep_minimum_runs: 10     ## ä¿å­˜æœ€å°‘è¿è¡Œæ•°ï¼ˆé»˜è®¤æ˜¯3ï¼‰

        
        
    - name: åˆ é™¤æ—§ç‰ˆæœ¬            ## Remove old Releases
      uses: dev-drprasad/delete-older-releases@v0.3.4          ## https://github.com/dev-drprasad/delete-older-releases
      if: env.UPLOAD_RELEASE == 'true' && !cancelled()
      with:
        keep_latest: 10           ## ä¿ç•™æœ€å°‘æ•°ï¼ˆé»˜è®¤æ˜¯3ï¼‰
        delete_tags: true
      env:
        GITHUB_TOKEN: ${{ secrets.REPO_TOKEN }}



    # - name: ç»“æŸç¼–è¯‘_å¾®ä¿¡é€šçŸ¥
      # uses: emon100/Action-Serverchan@v2
      # if: steps.organizer.outputs.status == 'success' && env.SERVERCHAN_SCKEY == 'true' || (github.event.inputs.wxtz == 'wxtz' && github.event.inputs.wxtz  != 'false')
      # with:
        # SCKEY: ${{ secrets.SCKEY }}
        # text: æ­å–œï¼${{env.CangKu}}ä»“åº“çš„#${{env.Run_number}}å·[${{matrix.target}}]ç¼–è¯‘æˆåŠŸå•¦ï¼
        # desp: æˆ‘äº²çˆ±çš„ä¸»äººæ‚¨ç¼–è¯‘çš„[${{matrix.target}}]æœºå‹æ–‡ä»¶ä¸­çš„${{ env.NAME2 }} ${{ env.NAME1 }}å›ºä»¶é¡ºåˆ©ç¼–è¯‘å®Œæˆäº†ï¼
        
        
              # å®Œæˆæ—¶é—´ï¼š${{ env.date1 }}
              
              
              # ä»“åº“åç§°ï¼š${{env.CangKu}}
              
              
              # å·¥ä½œæµå·ï¼š#${{env.Run_number}}å·
              
              
              # å›ºä»¶åç§°ï¼š${{matrix.target}}

              
              # å¥¶ç‰›å¿«ä¼ ï¼š${{ env.COWTRANSFER_URL }}
              
              
              # WeTransferï¼š${{ env.WETRANSFER_URL }}
              
              
              # å‘å¸ƒåœ°å€ï¼š${{ env.GITURL }}/releases
              

              # ç¥å°ä¸»äººè§äººçˆ±ï¼ŒèŠ±è§èŠ±å¼€ï¼Œè½¦è§è½¦è½½ï¼Œå¤©å¤©å¥½å¿ƒæƒ…ğŸˆï¼ï¼ï¼



